<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <script>
        window.onload = function () {
            /*
            *Promise 解决异步
            const pro = new Promise(function(resolve,reject){
              resolve 成功调用
              reject  失败调用
            })
            //成功回调
            pro.then(res =>{
                console.log(res)
            })
           // 捕获错误
            pro.catch(err =>{
                console.log(err)
            })
            */

            {
                let a = 10;
                new Promise(function (resolve, reject) {
                    if (a === 10) {
                        resolve('成功')
                    } else {
                        reject('失败')
                    }
                }).then(res => {
                    console.log(res)
                }).catch(err => {
                    console.log(err)
                })

            }

            {//Promise.resolve() 将现有的东西，转成一个promise对象，resolve状态，成功状态
                let p1 = Promise.resolve('成功');
                p1.then(res => {
                    console.log(res)
                })
                //等价于上面写法
                //    new Promise(resolve =>{
                //        resolve('成功')
                //    })

            }
            {
                let p1 = Promise.reject('失败')
                p1.then(res => {
                    console.log(res)
                }).catch(err => {
                    console.log(err)
                })
                //等价于上面写法
                //    new Promise((resolve,reject) =>{
                //        reject('失败')
                //    })
            }
            {//Promise.all([p1,p2,p3]) 把promise打包，扔到一个数组里面，打包完还是一个promise对象
                //必须确保，所有的promise对象，都是resolve状态，都是成功状态，才会返回结果
                //Promise.race([p1,p2,p3]) 只要有一个成功，就返回
                let p1 = Promise.resolve('aaa')
                let p2 = Promise.resolve('bbb')
                let p3 = Promise.resolve('ccc')
                Promise.all([p1, p2, p3]).then(res => {
                    console.log(res)//(3) ["aaa", "bbb", "ccc"]
                })

            }
            {//用户登录 -> 获取用户信息
                let status = 1;
                let userLogin = (resolve, reject) => {
                    setTimeout(() => {
                        if (status == 1) {
                            resolve({ data: '登录数据', msg: 'xxx', token: 'edkfnedkfndkjdk' })
                        } else {
                            reject('失败了')
                        }
                    },2000)
                };
                let getUserInfo = (resolve, reject) => {
                    setTimeout(() => {
                        if (status == 1) {
                            resolve({ data: '获取用户信息成功', msg: 'xxx', token: 'edkfnedkfndkjdk' })
                        } else {
                            reject('失败了')
                        }
                    },2000)
                };
                new Promise(userLogin).then(res =>{
                    console.log('用户登录成功')
                    return new Promise(getUserInfo)
                }).then(res =>{
                    console.log('获取用户信息成功')
                    console.log(res)
                })

            }







        }    
    </script>

</body>

</html>